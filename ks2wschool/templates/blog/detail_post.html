{% extends 'base.html' %}
{% load filter %}
{% load static %}
{% block content %}
<link rel='stylesheet' href="{% static 'detail_post.css' %}?after=31">
<style>
    
</style>
    <div id="post_head">{{ post.category }} 카테고리 게시글입니다.</div>
    <hr>
    <div id="post_main">
        <div id="post_title"><h2>글 제목 : {{ post.title }}</h2></div>
          <div id="post_main_left">
            <div id="post_writer"><p>글쓴이 : {{ post.author }}</p></div>
            <div id="post_good">
            <a href="{% url 'post_vote' post.id %}">
                추천 
                <span class ="badge rounded-pill bg-success">{{post.voter.count}}</span>
            </a>

            </div>
          </div>    
        <div id="content">{{ post.content|mark }}</div>
        
    </div>
    
    {% if user.is_authenticated %} 
    <button> <a href="{% url 'delete_post' post.id %}">삭제</a></button>
    <button> <a href="{% url 'update_post' post.id %}">수정</a></button>
    {% endif %}
        
       
        
        <hr>
        <div id ="post_post">

        </div>
        <h5 class="hits">조회수 : {{post.hits}} </h5>
        <p>-----------------------------</p>

        {% if post.comment_set.count > 0 %}
            {% for comment in post.comment_set.all %}
            
                    <div id="post_reply_writer">{{ comment.author.nickname}} 
                        <button><a href="{% url 'delete_comment' comment.id %}">삭제</a></button>
                        <button><a href="{% url 'update_comment' comment.id %}">수정</a></button>
                    </div>
                    <div id="post_reply"> {{comment.content}} ({{ comment.create_date }}) 
                        {% if comment.reply_set.count > 0 %}
                        <span class="text-danger small mx-2">  ({{ comment.reply_set.count }})</span>
                    {% endif %}
                    </div>
                    
                    {% if comment.reply_set.all %}
                        {% for reply in comment.reply_set.all %}
                            <div id="post_reply_again">⤷⤷  {{ reply.author.nickname}} :{{reply.content}} ({{reply.create_date}})   </div>
                           <button id="post_delete"> <a href="{% url 'delete_reply' reply.id %}">Delete</a></button>
                        {% endfor %}
                    {% else %}
                        <div id="post_another_reply">Nodata</div>
                    {% endif %}
                    <div action="{% url 'create_reply' %}?comment_id={{ comment.id }}" method = "post">
                        {% csrf_token %}
                    {% for field in reply_form %}
                        {{ field.errors }}
                        <div id="mb"><label for="{{ field.id_for_label }}">{{ field.label }}:</label></div>
                        {{ field }}
                        {% endfor %}
                        <input type="submit" value="답글">
                        </form>    
                    <hr>
                    
         
            {% endfor %}
        {% else %}
            <div id="post_nodata">No data</div>
        {% endif %}
        <form action="{% url 'create_comment' %}?post_id={{ post.id }}" method = "post">
            {% csrf_token %}
            {% for field in comment_form %}
                {{ field.errors }}
                <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                {{ field }}
            {% endfor %}
            <input type="submit" value="답글">    
        </form>
        </div>     
        
{% endblock %}