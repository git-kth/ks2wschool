{% extends 'base.html' %}
{% block content %}
    <h4>{{ post.category }} 카테고리 게시글입니다.</h4>
    {% if user.is_authenticated %}
    <a href="{% url 'delete_post' post.id %}">삭제</a>
    <a href="{% url 'update_post' post.id %}">수정</a>
    {% endif %}
        <p>글 제목 : {{ post.title }}</p>
        <p>글 내용 : {{ post.content }}</p>
        <p>글쓴이 : {{ post.author }}</p>
        <p>-----------------------------</p>
        {% if post.comment_set.count > 0 %}
            {% for comment in post.comment_set.all %}
            <tr>
                <td>
                    <p>댓글 내용 : {{comment.content}}
                        {% if comment.reply_set.count > 0 %}
                        <span class="text-danger small mx-2">  ({{ comment.reply_set.count }})</span>
                    {% endif %}
                    </p>
                    <p>작성자 :{{ comment.author.nickname}} ({{ comment.create_date }})
                        <a href="{% url 'delete_comment' comment.id %}">삭제</a>
                        <a href="{% url 'update_comment' comment.id %}">수정</a>
                    </p>
                    {% if comment.reply_set.all %}
                        {% for reply in comment.reply_set.all %}
                            <p>⤷⤷ {{reply.content}}/  작성자: {{ reply.author.nickname}} ({{reply.create_date}})</p>
                            <a href="{% url 'delete_reply' reply.id %}">삭제</a>
                        {% endfor %}
                    {% else %}
                        <p>답글 없음</p>
                    {% endif %}
                    <form action="{% url 'create_reply' %}?comment_id={{ comment.id }}" method = "post">
                        {% csrf_token %}
                    {% for field in reply_form %}
                        {{ field.errors }}
                        <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                        {{ field }}
                        {% endfor %}
                        <input type="submit" value="reply 작성">
                        </form>    
                    <p>-----------------------------</p>
                    
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <p>댓글 없음.</p>
        {% endif %}
        <form action="{% url 'create_comment' %}?post_id={{ post.id }}" method = "post">
            {% csrf_token %}
            {% for field in comment_form %}
                {{ field.errors }}
                <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                {{ field }}
            {% endfor %}
            <input type="submit" value="comment 작성">    
        </form>
        
        
{% endblock %}